# 🚀 新窗口对接指南

## 📍 当前位置
您现在在：`/home/ubuntu/web3`

## ⚡ 快速对接（推荐）

### 方法1：一键初始化脚本
```bash
cd /home/ubuntu/web3
source quick_setup_new_window.sh
```

### 方法2：手动设置环境变量
```bash
export HTTPS_PROXY=http://127.0.0.1:18443
export HTTP_PROXY=$HTTPS_PROXY
export ANTHROPIC_BASE_URL=https://api.anthropic.com
```

---

## 🔧 **关键配置信息**

### 环境变量
- **HTTPS_PROXY**: `http://127.0.0.1:18443`
- **HTTP_PROXY**: `$HTTPS_PROXY`
- **ANTHROPIC_BASE_URL**: `https://api.anthropic.com` ⭐ **关键**

### 服务状态检查
```bash
# 检查 WireGuard
sudo wg show

# 检查 tinyproxy
ps aux | grep tinyproxy

# 检查代理 IP
curl -x http://127.0.0.1:18443 https://ifconfig.me
```

### 测试 Claude CLI
```bash
claude -p "hello"
```

---

## 📁 **重要文件位置**

### 配置文件
- **WireGuard**: `/etc/wireguard/wg0.conf`
- **tinyproxy**: `/etc/tinyproxy/tinyproxy.conf`
- **环境变量**: `~/.bashrc`

### 脚本文件（在 `/home/ubuntu/web3`）
- `test_claude_proxy.sh` - 验证配置
- `restart_claude_proxy.sh` - 重启服务
- `quick_setup_new_window.sh` - 新窗口初始化
- `SURFSHARK_CLAUDE_配置文档.md` - 完整技术文档

---

## 🛠 **常用维护命令**

### 如果 Claude CLI 不工作
```bash
# 1. 检查环境变量
echo $ANTHROPIC_BASE_URL  # 应显示: https://api.anthropic.com
echo $HTTPS_PROXY         # 应显示: http://127.0.0.1:18443

# 2. 运行完整验证
./test_claude_proxy.sh

# 3. 如有问题，重启服务
./restart_claude_proxy.sh
```

### 代理相关
```bash
# 当前代理 IP（应该是 Surfshark 以色列节点）
curl -x http://127.0.0.1:18443 https://ifconfig.me

# 直连 IP（腾讯云）
curl https://ifconfig.me
```

---

## ⚠️ **常见问题**

### 问题1：环境变量失效
**现象**：`echo $ANTHROPIC_BASE_URL` 显示空白
**解决**：运行 `source ~/.bashrc` 或使用快速初始化脚本

### 问题2：Claude CLI 连接失败
**现象**：提示 "Unable to connect to Anthropic services"
**解决**：
1. 检查环境变量设置
2. 运行 `./test_claude_proxy.sh` 诊断
3. 如需要重启服务：`./restart_claude_proxy.sh`

### 问题3：代理服务未运行
**现象**：`curl -x http://127.0.0.1:18443` 失败
**解决**：
```bash
sudo systemctl restart wg-quick@wg0
sudo systemctl restart tinyproxy
```

---

## 📱 **新窗口快速检查清单**

打开新窗口后，依次确认：

- [ ] **位置正确**：`cd /home/ubuntu/web3`
- [ ] **环境变量设置**：`source quick_setup_new_window.sh`
- [ ] **Claude CLI 工作**：`claude -p "test"`
- [ ] **代理连接正常**：脚本会自动检查

如果所有检查都通过，您就可以在新窗口中正常使用 Claude CLI 了！

---

## 🎯 **核心原理提醒**

- **分流机制**：Claude CLI 走 Surfshark，其他应用走腾讯云直连
- **Cloudflare 绕过**：使用 `api.anthropic.com` 而非 `console.anthropic.com`
- **自动化**：所有服务开机自启，环境变量自动加载

**记住：如果遇到任何问题，查看 `SURFSHARK_CLAUDE_配置文档.md` 获取详细的故障排查指南！** 